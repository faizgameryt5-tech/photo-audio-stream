name: Photo + Audio Stream (5:40 hrs Auto-Restart)

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  photo-audio-stream:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install FFmpeg & curl
        run: |
          sudo apt update
          sudo apt install -y ffmpeg curl

      - name: Show Workspace Files (Debug)
        run: |
          echo "Workspace: $GITHUB_WORKSPACE"
          ls -la
          ls -la "$GITHUB_WORKSPACE"

      - name: Verify Background Image and Audio
        run: |
          if [ ! -f "$GITHUB_WORKSPACE/background.png" ]; then
            echo "‚ùå Error: background.png not found in workspace!" && exit 1
          fi

          if [ ! -f "$GITHUB_WORKSPACE/audio.mp3" ]; then
            echo "‚ùå Error: audio.mp3 not found in workspace!" && exit 1
          fi

          echo "‚úÖ Background image and audio found successfully."

      - name: Start 5:40 hrs Photo + Audio Stream with Auto-Restart
        run: |
          cd "$GITHUB_WORKSPACE"

          while true; do
            echo "‚ñ∂ Starting photo + audio stream for 5:40 hours..."
            ffmpeg -re -loop 1 -i background.png -i audio.mp3 \
              -c:v libx264 -tune stillimage -pix_fmt yuv420p \
              -c:a aac -b:a 192k \
              -shortest \
              -t 05:40:00 \
              -f flv rtmp://a.rtmp.youtube.com/live2/$YOUTUBE_STREAM_KEY

            echo "üîÅ Stream ended. Restarting in 10 seconds..."
            sleep 10
          done
