name: Photo + Audio Stream (5:40 hrs Auto-Restart)

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  photo-audio-stream:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install FFmpeg & curl
        run: |
          sudo apt update
          sudo apt install -y ffmpeg curl

      - name: Verify Background Image and Audio
        run: |
          if [ ! -f "./background.png" ]; then
            echo "Error: background.png not found!" && exit 1
          fi
          if [ ! -f "./audio.mp3" ]; then
            echo "Error: audio.mp3 not found!" && exit 1
          fi
          echo "Background image and audio found."

      - name: Start 5:40 hrs Photo + Audio Stream with Auto-Restart
        run: |
          while true; do
            echo "Starting photo + audio stream for 5:40 hours..."
            ffmpeg -re -loop 1 -i background.png -i audio.mp3 \
              -c:v libx264 -tune stillimage -pix_fmt yuv420p \
              -c:a aac -b:a 192k \
              -shortest \
              -t 05:40:00 \
              -f flv rtmp://a.rtmp.youtube.com/live2
            echo "Stream completed. Restarting in 10 seconds..."
            sleep 10
          done
